---
title: 计算机网络协议
tags:
  - 网络协议
category:
  - 技术文章
abbrlink: '17750952'
date: 2018-08-31 10:16:00
---

# 七层协定

​	越接近硬件的阶层为底层，越接近应用程序的层为高层。无论接收端还是发送端，每一阶层只认识对方的同一阶层数据。客户端通过应用程序将数据放入第七层，再将第七层数据打包到第六层，依次打包到第一层，然后传送给接收端，接收端主机由第一层开始，依序打开每个包，然后交给对应的阶层处理。

![OSI 七层协议数据的传递方式](https://raw.githubusercontent.com/lgsdaredevil/myblog/resource-myblog/source/favicons/article/OSI%20%E4%B8%83%E5%B1%82%E5%8D%8F%E8%AE%AE%E6%95%B0%E6%8D%AE%E7%9A%84%E4%BC%A0%E9%80%92%E6%96%B9%E5%BC%8F.png)

# TCP/IP    

​	TCP/IP 也是使用 OSI 七层协议的观念， 所以同 样具有分层的架构，只是将它简化为四层。

![OSI 与 TCP/IP 协议之相关性    ](https://raw.githubusercontent.com/lgsdaredevil/myblog/resource-myblog/source/favicons/article/osi%20%E4%B8%8E%20tcpip%20%E5%8D%8F%E8%AE%AE%E4%B9%8B%E7%9B%B8%E5%85%B3%E6%80%A7.png)

​	从图中可以发现，TCP/IP 将应用、表现、会谈三层整合成一个应用层，在 应用层上面可以实作的程序协议有 HTTP, SMTP, DNS 等等。 传送层则没有变，不过依 据传送的可靠性又将封包格式分为连接导向的 TCP 及非连接导向的 UDP 封包格式。网 络层也没有变，主要内容是提供了 IP 封包，并可选择最佳路由来到达目标 IP 地址。数据链结层与物理层则整合成为一个链结层，包括定义硬件讯号、 讯框转位串的编码 等等，因此主要与硬件 (不论是区网还是广域网) 有关。

### TCP/IP运作过程

1. 应用程序阶段：打开浏览器，在浏览器上面输入网址，按下 [Enter]。 此时网址与相关数据会被浏览器包成一个数据， 并向下传给 TCP/IP 的应用层；
2. 应用层：由应用层提供的 HTTP 通讯协议，将来自浏览器的数据包起来，并给予一个应用层表头，再向传送层丢去；
3. 传送层：由于 HTTP 为可靠联机，因此将该数据丢入TCP 封包内，并给予 一个 TCP 封包的表头，向网络层丢去；
4. 网络层：将 TCP 包裹包进 IP 封包内，再给予一个 IP 表头 (主要就是来源与目标的 IP)，向链结层丢去；
5. 链结层：如果使用以太网络时，此时 IP 会依据 CSMA/CD 的标准，包裹到 MAC 讯框中，并给予 MAC 表头，再转成位串后， 利用传输媒体传送到远程主机 上。 

# TCP三次握手

​	![三向交握之封包连接模式](https://raw.githubusercontent.com/lgsdaredevil/myblog/resource-myblog/source/favicons/article/%E4%B8%89%E5%90%91%E4%BA%A4%E6%8F%A1%E4%B9%8B%E5%B0%81%E5%8C%85%E8%BF%9E%E6%8E%A5%E6%A8%A1%E5%BC%8F.png)



* A：封包发起

   当客户端对服务器端联机时，就必须要送出一个要求联机的封包，此时客户端必须随机取用一个大于 1024 以上的端口来做为程序沟通的接口。然后在TCP 的表头当中，必须要带有 SYN 的主动联机(SYN=1)，并且记下发送出联机封包给服务器端的序号 (Sequence number = 10001) 。

* B：封包接收与确认封包传送

  当服务器接到这个封包，并确定要接收这个封包后，就会制作一个同时带有SYN=1，ACK=1的封包，其中acknowledge的号码要给客户端确认用，所以该数字会比（A步骤）里面的Sequence号码多一号（ack=10001+1=10002），那我们服务器也必须要确认客户端确实可以接收我们的封包才行， 所以也会发送出一个 Sequence (seq=20001) 给客户端，并且开始等待客户端给我们服务器端的回应。

* C：回送确认封包

  当客户端接收到来自服务器端的aACK数字后（10002）就能够确认之前那个要求封包被正常的接收了，接下来如果客户端也同意与服务器端建立联机时，就会再次发送一个确认封包 (ACK=1) 给服务器，亦即是 acknowledge = 20001+1 = 20002。

* D：取得最后的确认

  若一切顺利，在服务器端收到带有ACK=1且ack=20002的封包后，就能建立起这次的联机了。

### UDP协议

​	UDP和TCP不一样，UDP不提供可靠的传输模式，因为他不是面向连接的一个机制，因为在UDP的传输过程中，接收端在接收到封包后，不会回复响应封包（ACK）给发送端，所以封包并没有像TCP封包有较为严密的检查机制。UDP 可以在 Data 处填入更多的数据了。同时 UDP 比较 适合需要实时反应的一些数据流，例如影像实时传送软件等， 就可以使用这类的封包 传送。    